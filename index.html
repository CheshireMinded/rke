<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Alliance Dread Calculator - Weekend Kill Tracker</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="description" content="Track dreadnought kills for alliance players each weekend">
  <meta name="keywords" content="alliance, dreadnought, calculator, gaming, tracker, PWA">
  <meta name="author" content="Alliance Dread Calculator">
  
  <!-- PWA Security and Installation -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="DreadCalc">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#1a1a2e">
  <meta name="msapplication-tap-highlight" content="no">
  
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  
  <!-- PWA Icons -->
  <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icons/icon-512x512.png">
  <link rel="shortcut icon" href="./icons/icon-192x192.png">
  
  <!-- External Stylesheet -->
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <!-- Skip to content link for screen readers -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <div class="container">
    <!-- Theme and Accessibility Controls -->
    <div id="themeControls" class="flex-row" style="position: fixed; top: 20px; left: 20px; z-index: 1000; background: var(--card-bg); padding: 10px; border-radius: 8px; box-shadow: 0 2px 8px var(--shadow);">
      <button id="themeToggle" aria-label="Toggle theme">🌙</button>
      <select id="colorScheme" aria-label="Select color scheme">
        <option value="light">☀️ Light</option>
        <option value="dark" selected>🌙 Dark</option>
        <option value="blue">🔵 Blue</option>
        <option value="green">🟢 Green</option>
      </select>
      <button id="accessibilityToggle" aria-label="Accessibility settings">♿</button>
    </div>

    <!-- Accessibility Panel -->
    <div id="accessibilityPanel" style="display: none; position: fixed; top: 80px; left: 20px; background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px var(--shadow); z-index: 1000; min-width: 300px;">
      <h3>Accessibility Settings</h3>
      <button id="closeAccessibilityPanel" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">×</button>
      
      <div class="setting-item">
        <label>
          <input type="checkbox" id="highContrast">
          High Contrast Mode
        </label>
      </div>
      
      <div class="setting-item">
        <label>
          <input type="checkbox" id="largeText">
          Large Text
        </label>
      </div>
      
      <div class="setting-item">
        <label>
          <input type="checkbox" id="reduceMotion">
          Reduce Motion
        </label>
      </div>
      
      <div class="setting-item">
        <label>
          Font Scale: <span id="fontScaleValue">100%</span>
          <input type="range" id="fontScale" min="80" max="200" value="100">
        </label>
      </div>
    </div>

    <main id="main-content">
      <h1>⚔️ Alliance Dread Calculator</h1>
      <p style="text-align: center; color: var(--text-secondary); margin-bottom: 10px;">Track weekend dreadnought kills for your alliance players</p>

      <!-- Current Week Display -->
      <div class="section">
        <div class="flex-row" style="justify-content: space-between; align-items: center;">
          <h2>Current Week</h2>
          <div class="flex-row" style="gap: 10px;">
            <span id="currentWeekDisplay">Current Week: 2024-W01</span>
            <input type="number" id="defaultTarget" value="50" min="1" max="1000" 
                   onchange="dreadCalculator.updateTarget(parseInt(this.value) || 50)"
                   style="width: 80px;" aria-label="Default target">
            <label for="defaultTarget" style="white-space: nowrap;">Target</label>
          </div>
        </div>
      </div>

      <!-- Player Dread Tracking -->
      <div class="section" role="region" aria-label="Player Dread Tracking">
        <div class="flex-row" style="justify-content:space-between; gap:10px;">
          <h2>Player Dread Tracking</h2>
          <div class="flex-row" style="gap:6px;">
            <button id="addBtn" aria-label="Add new player">Add Player</button>
            <button class="secondary" id="removeBtn" disabled aria-label="Remove last player">Remove Last</button>
            <button class="secondary" id="clearAllBtn" aria-label="Clear all players">Clear All</button>
          </div>
        </div>
        <div id="playersContainer" role="list" aria-label="List of players"></div>
      </div>

      <!-- Weekend Summary -->
      <div class="section" id="summarySection" style="display: none;">
        <h2>Weekend Summary</h2>
        <div class="summary-stats">
          <div class="stat-card">
            <h3>Total Players</h3>
            <div class="value" id="totalPlayers">0</div>
          </div>
          <div class="stat-card">
            <h3>Total Dreads</h3>
            <div class="value" id="totalDreads">0</div>
          </div>
          <div class="stat-card">
            <h3>Average</h3>
            <div class="value" id="averageDreads">0</div>
          </div>
          <div class="stat-card">
            <h3>Top Performer</h3>
            <div class="value" id="topPerformer">-</div>
          </div>
        </div>
        
        <div class="leaderboard" id="leaderboard"></div>
      </div>

      <!-- Player Profiles -->
      <div class="section">
        <h2>👥 Player Profiles</h2>
        <div class="player-profiles">
          <div class="profile-selector">
            <select id="playerProfileSelect" onchange="dreadCalculator.showPlayerProfile(this.value)">
              <option value="">Select a player...</option>
            </select>
          </div>
          <div id="playerProfileDetails" class="profile-details" style="display: none;">
            <!-- Player profile details will be shown here -->
          </div>
        </div>
      </div>

      <!-- Weekly Management -->
      <div class="section">
        <h2>Weekly Management</h2>
        <div class="flex-row" style="gap: 10px; flex-wrap: wrap;">
          <button id="saveWeekBtn">💾 Save Week</button>
          <button id="loadWeekBtn">📂 Load Week</button>
          <button id="newWeekBtn">🆕 New Week</button>
          <button id="viewHistoryBtn">📈 View History</button>
        </div>
        
        <div id="historySection" style="display: none; margin-top: 20px;">
          <div id="weekSelector" style="margin-bottom: 15px;">
            <label for="weekSelect">Select Week:</label>
            <select id="weekSelect" onchange="dreadCalculator.loadSelectedWeek()">
              <option value="">Choose a week...</option>
            </select>
            <button id="deleteWeekBtn" class="danger" onclick="dreadCalculator.deleteSelectedWeek()" style="margin-left: 10px;">Delete Week</button>
          </div>
          
          <div id="copyPlayersSection" style="margin-bottom: 15px; padding: 15px; background: #1a1a2e; border-radius: 8px; border: 1px solid #333;">
            <h3 style="color: #64b5f6; margin-top: 0;">Copy Players from Another Week</h3>
            <div class="flex-row" style="margin-bottom: 10px;">
              <select id="copySourceWeek">
                <option value="">Select source week...</option>
              </select>
              <button onclick="dreadCalculator.copyPlayersFromWeek()">Copy Players</button>
            </div>
            <div class="small">This will copy player names and reset their dread counts to 0</div>
          </div>
        </div>
      </div>

      <!-- Export/Import -->
      <div class="section">
        <h2>Export & Import</h2>
        <div class="export-buttons">
          <button id="exportJsonBtn">📄 Export JSON</button>
          <button id="exportCsvBtn">📊 Export CSV</button>
          <button id="copyResultsBtn">📋 Copy Results</button>
          <button id="importDataBtn">📁 Import Data</button>
          <input type="file" id="importFile" accept=".json" style="display: none;">
        </div>
      </div>

      <!-- Analytics & Charts -->
      <div class="section">
        <h2>Analytics & Trends</h2>
        <div class="analytics-container">
          <div class="chart-section">
            <h3>Weekly Performance Trends</h3>
            <canvas id="weeklyTrendChart" width="400" height="200"></canvas>
          </div>
          <div class="chart-section">
            <h3>Player Performance Comparison</h3>
            <canvas id="playerComparisonChart" width="400" height="200"></canvas>
          </div>
          <div class="chart-section">
            <h3>Completion Rate Over Time</h3>
            <canvas id="completionRateChart" width="400" height="200"></canvas>
          </div>
          <div class="chart-section">
            <h3>Top Performers This Month</h3>
            <canvas id="topPerformersChart" width="400" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- Voice Input -->
      <div class="section">
        <h2>Voice Input</h2>
        <div class="voice-container">
          <div class="voice-controls">
            <button id="voiceInputBtn" onclick="dreadCalculator.startVoiceInput()">🎤 Start Voice Input</button>
            <button id="stopVoiceBtn" onclick="dreadCalculator.stopVoiceInput()" style="display: none;">⏹️ Stop</button>
          </div>
          <div class="voice-status" id="voiceStatus">Click the microphone to start voice input</div>
          <div class="voice-results" id="voiceResults"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- External Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <!-- Application Scripts -->
  <script src="./js/dread-calculator.js"></script>
  <script src="./js/theme-manager.js"></script>
  <script src="./js/gesture-manager.js"></script>
  <script src="./js/app.js"></script>
</body>
</html>
